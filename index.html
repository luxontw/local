<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BooksCom Bridge Exploit</title>
    <style>
        body { font-family: monospace; padding: 10px; background: #333; color: #fff; }
        .card { background: #444; padding: 15px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #666; }
        h2 { margin-top: 0; color: #0f0; border-bottom: 1px solid #666; padding-bottom: 5px; }
        #methods { color: #ffeb3b; font-size: 14px; white-space: pre-wrap; }
        input { width: 70%; padding: 10px; font-family: monospace; }
        button { width: 25%; padding: 10px; font-weight: bold; cursor: pointer; background: #0f0; border: none; }
        button.run { background: #f00; color: #fff; }
        .hint { font-size: 12px; color: #ccc; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>1. Bridge åŠŸèƒ½åˆ—è¡¨</h2>
        <div id="methods">æ­£åœ¨è®€å–...</div>
        <button onclick="analyzeBridge()" style="width:100%; margin-top:10px;">é‡æ–°æƒæ</button>
    </div>

    <div class="card">
        <h2>2. åŸ·è¡ŒæŒ‡ä»¤</h2>
        <p class="hint">è«‹åƒè€ƒä¸Šæ–¹çš„åˆ—è¡¨ï¼Œå°‡æŒ‡ä»¤è¼¸å…¥ä¸‹æ–¹ä¸¦åŸ·è¡Œã€‚<br>ä¾‹å¦‚: openUrl("http://google.com")</p>
        
        <input type="text" id="cmd" value='window.BooksComJsBridge.openBrowser("https://www.google.com")'>
        <button class="run" onclick="runCmd()">ç™¼å°„ (Run)</button>
        
        <div style="margin-top:10px;">
            <p>å¸¸ç”¨æŒ‡ä»¤æ¸¬è©¦ (é»æ“Šè‡ªå‹•å¡«å…¥):</p>
            <button onclick="fill('openSettings()')" style="width:auto; background:#555; color:#fff;">openSettings</button>
            <button onclick="fill('openBrowser(\'https://google.com\')')" style="width:auto; background:#555; color:#fff;">openBrowser</button>
            <button onclick="fill('finish()')" style="width:auto; background:#555; color:#fff;">finish (é—œé–‰)</button>
            <button onclick="fill('goBack()')" style="width:auto; background:#555; color:#fff;">goBack</button>
        </div>
    </div>

    <script>
        function analyzeBridge() {
            var output = document.getElementById('methods');
            var bridge = window.BooksComJsBridge;
            
            if (!bridge) {
                output.innerHTML = "âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° window.BooksComJsBridge\nè«‹ç¢ºèªæ­¤é é¢æ˜¯åœ¨ BooksPad ä¸Šé–‹å•Ÿã€‚";
                return;
            }

            var log = "âœ… ç™¼ç¾ç‰©ä»¶: window.BooksComJsBridge\n\n[å¯ç”¨åŠŸèƒ½]:\n";
            var count = 0;

            // æ·±åº¦æƒæå±¬æ€§èˆ‡æ–¹æ³•
            var props = [];
            // å˜—è©¦æ¨™æº–éæ­·
            for (var i in bridge) { props.push(i); }
            // å˜—è©¦ç²å–è‡ªèº«å±¬æ€§ (é‡å°ä¸å¯æšèˆ‰å±¬æ€§)
            try {
                var ownProps = Object.getOwnPropertyNames(bridge);
                props = props.concat(ownProps);
            } catch(e) {}

            // å»é™¤é‡è¤‡ä¸¦æ’åº
            props = [...new Set(props)].sort();

            props.forEach(function(prop) {
                try {
                    var type = typeof bridge[prop];
                    log += "ğŸ”¹ " + prop + " (" + type + ")\n";
                    count++;
                } catch(e) {
                    log += "ğŸ”¸ " + prop + " (æœªçŸ¥)\n";
                }
            });

            if (count === 0) {
                log += "âš ï¸ è­¦å‘Šï¼šç‰©ä»¶å­˜åœ¨ä½†ç„¡æ³•åˆ—èˆ‰å±¬æ€§ã€‚\né€™å¯èƒ½æ˜¯ Java Interface å°è£ã€‚\nè«‹ç›´æ¥å˜—è©¦ç›²æ¸¬æŒ‡ä»¤ã€‚";
            }

            output.innerHTML = log;
        }

        function runCmd() {
            var cmd = document.getElementById('cmd').value;
            try {
                // å¦‚æœç”¨æˆ¶æ²’æœ‰è¼¸å…¥å®Œæ•´è·¯å¾‘ï¼Œè‡ªå‹•è£œä¸Šå‰ç¶´ (æ–¹ä¾¿æ¸¬è©¦)
                if (cmd.indexOf('window') === -1 && cmd.indexOf('(') !== -1) {
                    // å˜—è©¦ç›´æ¥åŸ·è¡Œ bridge ä¸‹çš„æ–¹æ³•
                    var funcName = cmd.split('(')[0];
                    if (window.BooksComJsBridge[funcName]) {
                        window.BooksComJsBridge[funcName](eval(cmd.split('(')[1].replace(')', ''))); 
                        alert('å·²å‘¼å«: ' + funcName);
                        return;
                    }
                }
                
                // æ¨™æº– eval åŸ·è¡Œ
                var result = eval(cmd);
                alert("åŸ·è¡Œçµæœ: " + result);
            } catch (e) {
                alert("åŸ·è¡ŒéŒ¯èª¤: " + e.message);
            }
        }
        
        function fill(txt) {
            document.getElementById('cmd').value = "window.BooksComJsBridge." + txt;
        }

        // è‡ªå‹•å•Ÿå‹•æƒæ
        setTimeout(analyzeBridge, 500);
    </script>
</body>
</html>
